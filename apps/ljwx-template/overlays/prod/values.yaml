# 生产环境配置覆盖

# FastAPI 配置
apiFast:
  enabled: true
  replicaCount: 3  # 生产环境多副本

  image:
    tag: "v1.0.0"  # 生产使用具体版本号

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  env:
    LOG_LEVEL: "INFO"  # 生产环境 INFO 级别
    WEB_CONCURRENCY: "4"

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

# Spring Boot 配置
bootAdmin:
  enabled: true
  replicaCount: 2

  image:
    tag: "v1.0.0"

  resources:
    requests:
      memory: "1Gi"
      cpu: "1000m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

  env:
    SPRING_PROFILES_ACTIVE: "prod"

# 数据库配置（生产 RDS/云数据库）
database:
  host: prod-db.example.com
  port: 5432
  name: app_prod
  secretName: db-credentials-prod  # 使用 ExternalSecrets 或 SealedSecrets

# Redis 配置（生产 ElastiCache/云 Redis）
redis:
  host: prod-redis.example.com
  port: 6379
  secretName: redis-credentials-prod

# Migration 配置
migration:
  enabled: true
  image:
    tag: "v1.0.0"
  backoffLimit: 5
  ttlSecondsAfterFinished: 3600  # 保留 1 小时

# OpenTelemetry 配置
otel:
  enabled: true
  endpoint: "http://tempo-prod:4317"

# Ingress 配置（生产环境启用 HTTPS）
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: api.ljwx.example.com
      paths:
        - path: /
          pathType: Prefix
          service: api-fast
  tls:
    - secretName: api-ljwx-tls
      hosts:
        - api.ljwx.example.com

# ServiceMonitor
serviceMonitor:
  enabled: true
  interval: 30s
