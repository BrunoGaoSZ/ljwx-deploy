---
# =============================================================================
# ljwx-health Common ConfigMap
# 公共配置（非敏感信息）
# =============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: ljwx-health-config
  namespace: ljwx-health
  labels:
    app: ljwx-health
data:
  # Spring 配置
  SPRING_PROFILES_ACTIVE: "k8s"

  # 数据库配置（连接 infra namespace）
  DB_HOST: "mysql-infra.infra.svc.cluster.local"
  DB_PORT: "3306"
  DB_NAME: "ljwx_health"
  DB_USER: "root"

  # Spring DataSource 配置
  SPRING_DATASOURCE_URL: "jdbc:mysql://mysql-infra.infra.svc.cluster.local:3306/ljwx_health?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true"
  SPRING_DATASOURCE_USERNAME: "root"
  SPRING_DATASOURCE_DRIVER_CLASS_NAME: "com.mysql.cj.jdbc.Driver"

  # Redis 配置（连接 infra namespace）
  REDIS_HOST: "redis-infra.infra.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_DB: "1"

  # Spring Redis 配置
  SPRING_REDIS_HOST: "redis-infra.infra.svc.cluster.local"
  SPRING_REDIS_PORT: "6379"
  SPRING_REDIS_DATABASE: "1"

  # 日志配置
  LOG_LEVEL: "info"

  # OSS 配置
  OSS_BUCKET_NAME: "ljwx-health"
  OSS_ENDPOINT: "http://minio.infra.svc.cluster.local:9000"

  # Ollama 配置
  OLLAMA_API_URL: "http://ollama.infra.svc.cluster.local:11434"
  OLLAMA_MODEL_NAME: "ljwx-health-enhanced:latest"

  # LJWX 配置
  LJWX_LOGO_UPLOAD_PATH: "/app/uploads"
  LJWX_LICENSE_ENABLED: "false"
  LJWX_LICENSE_TRIAL_MODE: "false"

  # 时区配置
  TZ: "Asia/Shanghai"

  # Flyway 数据库迁移配置
  # ✅ 启用 Flyway - 使用新基线 V1.0.0（2026-01-03）
  SPRING_FLYWAY_ENABLED: "true"
  SPRING_FLYWAY_BASELINE_ON_MIGRATE: "true"  # 已有数据库从 baseline 开始
  SPRING_FLYWAY_BASELINE_VERSION: "0"
  SPRING_FLYWAY_LOCATIONS: "classpath:db/migration"
  SPRING_FLYWAY_VALIDATE_ON_MIGRATE: "true"
  SPRING_FLYWAY_CLEAN_DISABLED: "true"  # 生产环境禁用 clean
